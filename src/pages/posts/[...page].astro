---
import type { GetStaticPathsOptions, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import PostCard from "../../components/PostCard.astro";
import Pagination from "../../components/Pagination.astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = await getCollection("posts");
  const sorted = posts.sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime()
  );
  return paginate(sorted, { pageSize: 10 });
}

interface Props {
  page: Page<CollectionEntry<"posts">>;
}

const { page } = Astro.props as Props;
const renderedPosts = await Promise.all(
  page.data.map(async (post: CollectionEntry<"posts">) => ({
    post,
    Content: (await render(post)).Content,
  }))
);
---

<Layout title={`Posts - Page ${page.currentPage}`}>
  <nav class="mb-6">
    <a class="text-blue-600 dark:text-blue-400 hover:underline" href="/">‚Üê Back to home</a>
  </nav>

  <h1 class="text-3xl font-bold mb-6">Posts</h1>

  <div class="space-y-8">
    {
      renderedPosts.map(({ post, Content }) => (
        <PostCard post={post} Content={Content} />
      ))
    }
  </div>

  <Pagination
    currentPage={page.currentPage}
    totalPages={page.lastPage}
    prevUrl={page.url.prev}
    nextUrl={page.url.next}
  />
</Layout>
